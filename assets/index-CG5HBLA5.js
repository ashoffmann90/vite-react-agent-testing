var y=Object.defineProperty;var S=(e,t,o)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var h=(e,t,o)=>(S(e,typeof t!="symbol"?t+"":t,o),o);import{i as u,G as f,q as l,S as w,t as g,m as d,H as O,J as b,n as E,c as R,K as M,L as A}from"./index-DbYqWX7c.js";import{H as m}from"./harvest-scheduler-CkwrgQ_O.js";import{A as T,i as P,g as j,v as C}from"./aggregate-base-ChhHcUTy.js";const r={REACT:"React",NEXTJS:"NextJS",VUE:"Vue",NUXTJS:"NuxtJS",ANGULAR:"Angular",ANGULARUNIVERSAL:"AngularUniversal",SVELTE:"Svelte",SVELTEKIT:"SvelteKit",PREACT:"Preact",PREACTSSR:"PreactSSR",ANGULARJS:"AngularJS",BACKBONE:"Backbone",EMBER:"Ember",METEOR:"Meteor",ZEPTO:"Zepto",JQUERY:"Jquery",MOOTOOLS:"MooTools",QWIK:"Qwik",ELECTRON:"Electron"};function N(){if(!u)return[];const e=[];try{k()&&(e.push(r.REACT),U()&&e.push(r.NEXTJS)),x()&&(e.push(r.VUE),L()&&e.push(r.NUXTJS)),G()&&(e.push(r.ANGULAR),I()&&e.push(r.ANGULARUNIVERSAL)),v()&&(e.push(r.SVELTE),_()&&e.push(r.SVELTEKIT)),B()&&(e.push(r.PREACT),J()&&e.push(r.PREACTSSR)),D()&&e.push(r.ANGULARJS),Object.prototype.hasOwnProperty.call(window,"Backbone")&&e.push(r.BACKBONE),Object.prototype.hasOwnProperty.call(window,"Ember")&&e.push(r.EMBER),Object.prototype.hasOwnProperty.call(window,"Meteor")&&e.push(r.METEOR),Object.prototype.hasOwnProperty.call(window,"Zepto")&&e.push(r.ZEPTO),Object.prototype.hasOwnProperty.call(window,"jQuery")&&e.push(r.JQUERY),Object.prototype.hasOwnProperty.call(window,"MooTools")&&e.push(r.MOOTOOLS),Object.prototype.hasOwnProperty.call(window,"qwikevents")&&e.push(r.QWIK),q()&&e.push(r.ELECTRON)}catch{}return e}function k(){try{return Object.prototype.hasOwnProperty.call(window,"React")||Object.prototype.hasOwnProperty.call(window,"ReactDOM")||Object.prototype.hasOwnProperty.call(window,"ReactRedux")||document.querySelector("[data-reactroot], [data-reactid]")||(()=>{const e=document.querySelectorAll("body > div");for(let t=0;t<e.length;t++)if(Object.prototype.hasOwnProperty.call(e[t],"_reactRootContainer"))return!0})()}catch{return!1}}function U(){try{return Object.prototype.hasOwnProperty.call(window,"next")&&Object.prototype.hasOwnProperty.call(window.next,"version")}catch{return!1}}function x(){try{return Object.prototype.hasOwnProperty.call(window,"Vue")}catch{return!1}}function L(){try{return Object.prototype.hasOwnProperty.call(window,"$nuxt")&&Object.prototype.hasOwnProperty.call(window.$nuxt,"nuxt")}catch{return!1}}function G(){try{return Object.prototype.hasOwnProperty.call(window,"ng")||document.querySelector("[ng-version]")}catch{return!1}}function I(){try{return document.querySelector("[ng-server-context]")}catch{return!1}}function v(){try{return Object.prototype.hasOwnProperty.call(window,"__svelte")}catch{return!1}}function _(){try{return!!Object.keys(window).find(e=>e.startsWith("__sveltekit"))}catch{return!1}}function B(){try{return Object.prototype.hasOwnProperty.call(window,"preact")}catch{return!1}}function J(){try{return document.querySelector('script[type="__PREACT_CLI_DATA__"]')}catch{return!1}}function D(){try{return Object.prototype.hasOwnProperty.call(window,"angular")||document.querySelector(".ng-binding, [ng-app], [data-ng-app], [ng-controller], [data-ng-controller], [ng-repeat], [data-ng-repeat]")||document.querySelector('script[src*="angular.js"], script[src*="angular.min.js"]')}catch{return!1}}function q(){try{return typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0}catch{return!1}}class V extends T{constructor(t,o){super(t,o,f);let s;l("block-err",()=>{this.blocked=!0,s&&(s.aborted=!0)},this.featureName,this.ee),l(w,this.storeSupportabilityMetrics.bind(this),this.featureName,this.ee),l(g,this.storeEventMetrics.bind(this),this.featureName,this.ee),this.singleChecks(),this.eachSessionChecks(),this.ee.on("drain-".concat(this.featureName),()=>{s=new m("jserrors",{onUnload:()=>this.unload()},this),s.harvest.on("jserrors",()=>({body:this.aggregator.take(["cm","sm"])}))}),this.drain()}storeSupportabilityMetrics(t,o){if(this.blocked)return;const s=M,n={name:t};this.aggregator.storeMetric(s,t,n,o)}storeEventMetrics(t,o){if(this.blocked)return;const s=A,n={name:t};this.aggregator.store(s,t,n,o)}singleChecks(){var p;const{distMethod:t,loaderType:o}=d(this.agentIdentifier);if(o&&this.storeSupportabilityMetrics("Generic/LoaderType/".concat(o,"/Detected")),t&&this.storeSupportabilityMetrics("Generic/DistMethod/".concat(t,"/Detected")),u){this.storeSupportabilityMetrics("Generic/Runtime/Browser/Detected");const i=(p=document==null?void 0:document.currentScript)==null?void 0:p.nonce;i&&i!==""&&this.storeSupportabilityMetrics("Generic/Runtime/Nonce/Detected"),O(()=>{N().forEach(c=>{this.storeSupportabilityMetrics("Framework/"+c+"/Detected")})})}else b?this.storeSupportabilityMetrics("Generic/Runtime/Worker/Detected"):this.storeSupportabilityMetrics("Generic/Runtime/Unknown/Detected");P()&&this.storeSupportabilityMetrics("Generic/FileProtocol/Detected");const s=j(this.agentIdentifier);s.length>0&&this.storeSupportabilityMetrics("Generic/Obfuscate/Detected"),s.length>0&&!C(s)&&this.storeSupportabilityMetrics("Generic/Obfuscate/Invalid");const{proxy:n,privacy:a}=E(this.agentIdentifier);n.assets&&this.storeSupportabilityMetrics("Config/AssetsUrl/Changed"),n.beacon&&this.storeSupportabilityMetrics("Config/BeaconUrl/Changed"),u&&a.cookies_enabled||this.storeSupportabilityMetrics("Config/SessionTracking/Disabled")}eachSessionChecks(){u&&R("pageshow",t=>{t!=null&&t.persisted&&this.storeSupportabilityMetrics("Generic/BFCache/PageRestored")})}unload(){try{let n=function(i){return s.some(c=>i.name.indexOf(c)>=0)},a=function(i){return o.includes(i.initiatorType)};if(this.resourcesSent)return;this.resourcesSent=!0;const t=d(this.agentIdentifier),o=["beacon","fetch","xmlhttprequest"],s=["nr-data.net","newrelic.com","nr-local.net","localhost"];if(((performance==null?void 0:performance.getEntriesByType("resource"))||[]).forEach(i=>{n(i)?a(i)?this.storeSupportabilityMetrics("Generic/Resources/Ajax/Internal"):this.storeSupportabilityMetrics("Generic/Resources/Non-Ajax/Internal"):a(i)?this.storeSupportabilityMetrics("Generic/Resources/Ajax/External"):this.storeSupportabilityMetrics("Generic/Resources/Non-Ajax/External")}),t.ptid&&this.storeSupportabilityMetrics("PageSession/Feature/SessionTrace/DurationMs",Math.round(performance.now())),typeof performance<"u"){const i=performance.getEntriesByType("mark"),c=performance.getEntriesByType("measure");this.storeSupportabilityMetrics("Generic/Performance/Mark/Seen",i.length),this.storeSupportabilityMetrics("Generic/Performance/Measure/Seen",c.length)}}catch{}}}h(V,"featureName",f);export{V as Aggregate};
